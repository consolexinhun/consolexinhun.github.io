---
title: struct_union
date: 2022-08-04 16:17:43
permalink: /pages/67ee02/
categories:
  - modern_cpp_programming
  - enum-struct-control_flow
tags:
  - 
---
结构体能将不同的变量放到一个单元里

```
struct A {
    int x;
    char y;
    float z;
};

```

没有名字的是匿名 结构体/共用体

```
struct A {
struct { // anonymous struct
int x, y;
};
char z;
};

```


bitfield 的宽度是固定的，可以保存字而不是字节

```
struct S1 {
int b1 : 10; // range [0, 1023]
int b2 : 10; // range [0, 1023]
int b3 : 8; // range [0, 255]
}; // sizeof(S1): 4 bytes
struct S2 {
int b1 : 10;
int : 0; // reset: force the next field
int b2 : 10; // to start at bit 32
}; // sizeof(S1): 8 bytes
```


共用体能在相同的内存位置存不同的数据类型

* 只能容纳最大的数据成员
* 数据成员的内容会被其他成员覆盖

```
union A {
int x;
char y;
}; // sizeof(A): 4
A a;
a.x = 1023; // bits: 00..000001111111111
a.y = 0; // bits: 00..000001100000000
cout << a.x; // print 512 + 256 = 768
```

小端模式的编码和内存中存储的顺序是相反的，y 是 x 的最后的字节


![](https://i.imgur.com/EkjxTwY.png)



C++ 17 引入了 `std::variant` 表示安全的共用体
